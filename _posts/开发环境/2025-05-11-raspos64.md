---
title: 树梅派系统制作
category: [开发环境]
tags: [raspberry, 树莓派, rpi-imager]
---

> 在嵌入式软件开发中，常常需要对一些 demo 快速验证，我常常使用树莓派来搭建环境，因为便宜、社区活跃、简单方便 😂，下面记录我搭建环境的过程，涉及制作系统、配置网络、配置硬件端口等。
{: .prompt-info }

## 安装镜像工具

```bash
sudo apt update
sudo apt install rpi-imager
```

## 制卡

1. 启动 rpi-imager；
![](/assets/img/post/开发环境/rpi-imager0.webp)
2. 选择设备，是 PI5 就选择 PI5，是 PI4 就选择 PI4；
![](/assets/img/post/开发环境/rpi-imager1.webp)
3. 选择系统，我选择 PI OS(64bit);
![](/assets/img/post/开发环境/rpi-imager2.webp)
4. 选择要写入的 SD 卡；
![](/assets/img/post/开发环境/rpi-imager3.webp)
5. 设置
![](/assets/img/post/开发环境/rpi-imager4.webp)
6. 设置 wifi, 我一般用手机热点（这步很重要，系统做好后需要依赖 wifi 网络登陆到系统设备 eth0 的静态 IP）；
![](/assets/img/post/开发环境/rpi-imager5.webp)
7. 使能 SSH 服务；
![](/assets/img/post/开发环境/rpi-imager6.webp)
8. 按图上选择就行；
![](/assets/img/post/开发环境/rpi-imager7.webp)
9. 点击 YES，坐等烧写完成。
![](/assets/img/post/开发环境/rpi-imager8.webp)

## 配置静态 IP
1. 我一般设置为 192.168.1.4；

```bash
 sudo nmcli connection add type ethernet ifname eth0 con-name "StaticLAN" ipv4.addresses 192.168.1.4/24 ipv4.gateway 192.168.1.1 ipv4.dns "8.8.8.8,8.8.4.4" ipv4.method manual
```
2. 重启网卡

```bash
sudo systemctl restart NetworkManager
```

## 启用串口(raspberry pi 4B)

```bash
sudo raspi-config
● 选择 "Interfacing Options" > "Serial"
● 提示 "Would you like a login shell over serial?" 选择 NO（避免串口被控制台占用）
● 提示 "Would you like the serial port hardware to be enabled?" 选择 YES
```

## 启用 SPI(raspberry pi 4B)
1. 假设我使用的是如下的端口

```bash
硬件连接方案：

树莓派4B               外围设备1              外围设备2
SCLK (引脚23)  ------> SCLK             ------> SCLK
MOSI (引脚19)  ------> MOSI             ------> MOSI
MISO (引脚21)  <------ MISO             <------ MISO
CE0  (引脚24)  ------> 设备1的片选
CE1  (引脚26)  ------> 设备2的片选

----------------------------------------------------

引脚和 GPIO 编号对应关系:

MOSI: GPIO10 (引脚19)
MISO: GPIO9  (引脚21)
SCLK: GPIO11 (引脚23)
CE0:  GPIO8  (引脚24)
CE1:  GPIO7  (引脚26)
```
2. 使能
```bash
sudo raspi-config
● 选择 "Interfacing Options" > "SPI"
● 提示 "Would you like the SPI interface to be enabled?" 选择 YES
```

## 交叉编译器

```bash
https://developer.arm.com/-/media/Files/downloads/gnu/12.2.rel1/binrel/arm-gnu-toolchain-12.2.rel1-x86_64-aarch64-none-linux-gnu.tar.xz?rev=6750d007ffbf4134b30ea58ea5bf5223&hash=0F1CE8273B8A30129CA04BD61FFB547D
```

## Web 串口调试助手

```bash
https://serial.keysking.com/
```